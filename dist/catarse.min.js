/*
    Catarse JS components
    Copyright (c) 2007 - 2015 Diogo Biazus
    Licensed under the MIT license
    Version: 0.0.6
*/
window.c=function(){return{models:{},pages:{},admin:{},h:{}}}(),window.c.h=function(a,b){var c=function(a,c){return c=c||"DD/MM/YYYY",a?b(a).format(c):"no date"},d=function(a,c){var d=b(a,c||"DD/MM/YYYY");return d.isValid()?d:b(a)},e=function(a,b){return function(c,d,e){if(null===c||void 0===c)return null;var f="\\d(?=(\\d{"+(e||3)+"})+"+(d>0?"\\D":"$")+")",g=c.toFixed(Math.max(0,~~d));return(b?g.replace(".",b):g).replace(new RegExp(f,"g"),"$&"+(a||","))}},f=e(".",","),g=function(b,c){var d=a.prop(b);return d.toggle=function(){d(d()===c?b:c)},d},h=a.postgrest.filtersVM({id:"eq"}),i=function(){return a('.u-text-center.u-margintop-30[style="margin-bottom:-110px;"]',[a('img[alt="Loader"][src="https://s3.amazonaws.com/catarse.files/loader.gif"]')])};return{momentify:c,momentFromString:d,formatNumber:f,idVM:h,toggleProp:g,loader:i}}(window.m,window.moment),window.c.models=function(a){var b=a.postgrest.model("contribution_details"),c=a.postgrest.model("contributions"),d=a.postgrest.model("team_totals"),e=a.postgrest.model("team_members");return e.pageSize(40),{contributionDetail:b,contributions:c,teamTotal:d,teamMember:e}}(window.m),window.c.admin.Contributions=function(a,b,c){var d=b.admin;return{controller:function(){var c=d.contributionListVM,e=d.contributionFilterVM,f=a.prop(""),g=[{component:"AdminUser",wrapperClass:".w-col.w-col-4"},{component:"AdminProject",wrapperClass:".w-col.w-col-4"},{component:"AdminContribution",wrapperClass:".w-col.w-col-2"},{component:"PaymentStatus",wrapperClass:".w-col.w-col-2"}],h=[{component:"AdminInputAction",data:{getKey:"user_id",updateKey:"contribution_id",callToAction:"Transferir",innerLabel:"Id do novo apoiador:",outerLabel:"Transferir Apoio",placeholder:"ex: 129908",model:b.models.contributions}}],i=[{component:"FilterMain",data:{vm:e.full_text_index,placeholder:"Busque por projeto, email, Ids do usuário e do apoio..."}},{component:"FilterDropdown",data:{label:"Com o estado",name:"state",vm:e.state,options:[{value:"",option:"Qualquer um"},{value:"paid",option:"paid"},{value:"refused",option:"refused"},{value:"pending",option:"pending"},{value:"pending_refund",option:"pending_refund"},{value:"refunded",option:"refunded"},{value:"chargeback",option:"chargeback"},{value:"deleted",option:"deleted"}]}},{component:"FilterDropdown",data:{label:"gateway",name:"gateway",vm:e.gateway,options:[{value:"",option:"Qualquer um"},{value:"Pagarme",option:"Pagarme"},{value:"MoIP",option:"MoIP"},{value:"PayPal",option:"PayPal"},{value:"Credits",option:"Créditos"}]}},{component:"FilterNumberRange",data:{label:"Valores entre",first:e.value.gte,last:e.value.lte}},{component:"FilterDateRange",data:{label:"Período do apoio",first:e.created_at.gte,last:e.created_at.lte}}],j=function(){return c.firstPage(e.parameters()).then(null,function(a){f(a.message)}),!1};return{filterVM:e,filterBuilder:i,itemActions:h,itemBuilder:g,listVM:{list:c,error:f},submit:j}},view:function(c){return[a.component(b.AdminFilter,{form:c.filterVM.formDescriber,filterBuilder:c.filterBuilder,submit:c.submit}),a.component(b.AdminList,{vm:c.listVM,itemBuilder:c.itemBuilder,itemActions:c.itemActions})]}}}(window.m,window.c,window.c.h),window.c.admin.contributionFilterVM=function(a,b,c){var d=a.postgrest.filtersVM({full_text_index:"@@",state:"eq",gateway:"eq",value:"between",created_at:"between"});return d.state(""),d.gateway(""),d.order({id:"desc"}),d.created_at.lte.toFilter=function(){return b.momentFromString(d.created_at.lte()).endOf("day").format("")},d.created_at.gte.toFilter=function(){return b.momentFromString(d.created_at.gte()).format()},d.full_text_index.toFilter=function(){return c(d.full_text_index())},d}(window.m,window.c.h,window.replaceDiacritics),window.c.admin.contributionListVM=function(a,b){return a.postgrest.paginationVM(b.contributionDetail.getPageWithToken)}(window.m,window.c.models),window.c.AdminContribution=function(a,b){return{view:function(c,d){var e=d.item;return a(".w-row.admin-contribution",[a(".fontweight-semibold.lineheight-tighter.u-marginbottom-10.fontsize-small","R$"+e.value),a(".fontsize-smallest.fontcolor-secondary",b.momentify(e.created_at,"DD/MM/YYYY HH:mm[h]")),a(".fontsize-smallest",["ID do Gateway: ",a('a.alt-link[target="_blank"][href="https://dashboard.pagar.me/#/transactions/'+e.gateway_id+'"]',e.gateway_id)])])}}}(window.m,window.c.h),window.c.AdminDetail=function(a,b,c){return{controller:function(){},view:function(d,e){var f=e.actions,g=e.item();return a("#admin-contribution-detail-box",[a(".divider.u-margintop-20.u-marginbottom-20"),a(".w-row.u-marginbottom-30",b.map(f,function(b){return a.component(c[b.component],{data:b.data,item:e.item})})),a(".w-row.card.card-terciary.u-radius",[a.component(c.AdminTransaction,{contribution:g}),a.component(c.AdminTransactionHistory,{contribution:g}),a.component(c.AdminReward,{contribution:g,key:g.key})])])}}}(window.m,window._,window.c),window.c.AdminFilter=function(a,b,c,d){return{controller:function(){return{toggler:d.toggleProp(!1,!0)}},view:function(d,e){var f=e.filterBuilder,g=c.findWhere(f,{component:"FilterMain"});return b("#admin-contributions-filter.w-section.page-header",[b(".w-container",[b(".fontsize-larger.u-text-center.u-marginbottom-30","Apoios"),b(".w-form",[b("form",{onsubmit:e.submit},[c.findWhere(f,{component:"FilterMain"})?b.component(a[g.component],g.data):"",b(".u-marginbottom-20.w-row",b('button.w-col.w-col-12.fontsize-smallest.link-hidden-light[style="background: none; border: none; outline: none; text-align: left;"][type="button"]',{onclick:d.toggler.toggle},"Filtros avançados  >")),d.toggler()?b("#advanced-search.w-row.admin-filters",[c.map(f,function(c){return"FilterMain"!==c.component?b.component(a[c.component],c.data):""})]):""])])])])}}}(window.c,window.m,window._,window.c.h),window.c.AdminInputAction=function(a,b,c){return{controller:function(c){var d=c.data,e=a.prop(!1),f=a.prop(!1),g=(a.prop(!1),{}),h=c.item,i=d.getKey,j=a.prop("");b.idVM.id(h[d.updateKey]);var k=a.postgrest.loaderWithToken(d.model.patchOptions(b.idVM.parameters(),g)),l=function(a){h[i]=a[0][i],f(!1),e(!0)},m=function(){return g[i]=j(),k.load().then(l,f),!1},n=function(a,b,c){c.onunload=function(){e(!1),j("")}};return{complete:e,error:f,l:k,newValue:j,submit:m,toggler:b.toggleProp(!1,!0),unload:n}},view:function(b,c){var d=c.data,e=b.l()?"por favor, aguarde...":d.callToAction;return a(".w-col.w-col-2",[a("button.btn.btn-small.btn-terciary",{onclick:b.toggler.toggle},d.outerLabel),b.toggler()?a(".dropdown-list.card.u-radius.dropdown-list-medium.zindex-10",{config:b.unload},[a("form.w-form",{onsubmit:b.submit},b.complete()?b.error()?[a('.w-form-error[style="display:block;"]',[a("p","Houve um problema na requisição. O apoio não foi transferido!")])]:[a('.w-form-done[style="display:block;"]',[a("p","Apoio transferido com sucesso!")])]:[a("label",d.innerLabel),a('input.w-input.text-field[type="text"][placeholder="'+d.placeholder+'"]',{onchange:a.withAttr("value",b.newValue),value:b.newValue()}),a('input.w-button.btn.btn-small[type="submit"][value="'+e+'"]')])]):""])}}}(window.m,window.c.h,window.c),window.c.AdminItem=function(a,b,c,d){return{controller:function(a){var b=c.toggleProp(!1,!0);return{displayDetailBox:b}},view:function(c,e){var f=e.item();return a(".w-clearfix.card.u-radius.u-marginbottom-20.results-admin-items",[a(".w-row",[b.map(e.builder,function(b){return a(b.wrapperClass,[a.component(d[b.component],{item:f,key:f.key})])})]),a("button.w-inline-block.arrow-admin.fa.fa-chevron-down.fontcolor-secondary",{onclick:c.displayDetailBox.toggle}),c.displayDetailBox()?a.component(d.AdminDetail,{item:e.item,actions:e.actions,key:f.key}):""])}}}(window.m,window._,window.c.h,window.c),window.c.AdminList=function(a,b,c){c.admin;return{controller:function(a){var b=a.vm.list;!b.collection().length&&b.firstPage&&b.firstPage().then(null,function(b){a.vm.error(b.message)})},view:function(d,e){var f=e.vm.list,g=e.vm.error;return a(".w-section.section",[a(".w-container",g()?a(".card.card-error.u-radius.fontweight-bold",g()):[a(".w-row.u-marginbottom-20",[a(".w-col.w-col-9",[a(".fontsize-base",f.isLoading()?"Buscando apoios...":[a("span.fontweight-semibold",f.total())," apoios encontrados"])])]),a("#admin-contributions-list.w-container",[f.collection().map(function(b){return a.component(c.AdminItem,{builder:e.itemBuilder,actions:e.itemActions,item:a.prop(b),key:b.key})}),a(".w-section.section",[a(".w-container",[a(".w-row",[a(".w-col.w-col-2.w-col-push-5",[f.isLoading()?b.loader():a("button#load-more.btn.btn-medium.btn-terciary",{onclick:f.nextPage},"Carregar mais")])])])])])])])}}}(window.m,window.c.h,window.c),window.c.AdminProject=function(a,b){return{view:function(c,d){var e=d.item;return a(".w-row.admin-project",[a(".w-col.w-col-3.w-col-small-3.u-marginbottom-10",[a("img.thumb-project.u-radius[src="+e.project_img+"][width=50]")]),a(".w-col.w-col-9.w-col-small-9",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-10",[a('a.alt-link[target="_blank"][href="/'+e.permalink+'"]',e.project_name)]),a(".fontsize-smallest.fontweight-semibold",e.project_state),a(".fontsize-smallest.fontcolor-secondary",b.momentify(e.project_online_date)+" a "+b.momentify(e.project_expires_at))])])}}}(window.m,window.c.h),window.c.AdminReward=function(a,b,c){return{view:function(d,e){var f=e.contribution.reward||{},g=parseInt(f.paid_count)+parseInt(f.waiting_payment_count);return a(".w-col.w-col-4",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-20","Recompensa"),a(".fontsize-smallest.lineheight-looser",c.isEmpty(f)?"Apoio sem recompensa.":["ID: "+f.id,a("br"),"Valor mínimo: R$"+b.formatNumber(f.minimum_value,2,3),a("br"),a.trust("Disponíveis: "+g+" / "+(f.maximum_contributions||"&infin;")),a("br"),"Aguardando confirmação: "+f.waiting_payment_count,a("br"),"Descrição: "+f.description])])}}}(window.m,window.c.h,window._),window.c.AdminTransactionHistory=function(a,b,c){return{controller:function(a){var d=a.contribution,e=c.reduce([{date:d.paid_at,name:"Apoio confirmado"},{date:d.pending_refund_at,name:"Reembolso solicitado"},{date:d.refunded_at,name:"Estorno realizado"},{date:d.created_at,name:"Apoio criado"},{date:d.refused_at,name:"Apoio cancelado"},{date:d.deleted_at,name:"Apoio excluído"},{date:d.chargeback_at,name:"Chargeback"}],function(a,c){return null!==c.date&&void 0!==c.date?(c.originalDate=c.date,c.date=b.momentify(c.date,"DD/MM/YYYY, HH:mm"),a.concat(c)):a},[]);return{orderedEvents:c.sortBy(e,"originalDate")}},view:function(b){return a(".w-col.w-col-4",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-20","Histórico da transação"),b.orderedEvents.map(function(b){return a(".w-row.fontsize-smallest.lineheight-looser.date-event",[a(".w-col.w-col-6",[a(".fontcolor-secondary",b.date)]),a(".w-col.w-col-6",[a("div",b.name)])])})])}}}(window.m,window.c.h,window._),window.c.AdminTransaction=function(a,b){return{view:function(c,d){var e=d.contribution;return a(".w-col.w-col-4",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-20","Detalhes do apoio"),a(".fontsize-smallest.lineheight-looser",["Valor: R$"+b.formatNumber(e.value,2,3),a("br"),"Taxa: R$"+b.formatNumber(e.gateway_fee,2,3),a("br"),"Anônimo: "+(e.anonymous?"Sim":"Não"),a("br"),"Id pagamento: "+e.gateway_id,a("br"),"Apoio: "+e.contribution_id,a("br"),"Chave: \n",a("br"),e.key,a("br"),"Meio: "+e.gateway,a("br"),"Operadora: "+(e.gateway_data&&e.gateway_data.acquirer_name),a("br"),function(){return e.is_second_slip?[a('a.link-hidden[href="#"]',"Boleto bancário")," ",a("span.badge","2a via")]:void 0}()])])}}}(window.m,window.c.h),window.c.AdminUser=function(a){return{view:function(b,c){var d=c.item,e=function(){return d.user_profile_img||"/assets/catarse_bootstrap/user.jpg"};return a(".w-row.admin-user",[a(".w-col.w-col-3.w-col-small-3.u-marginbottom-10",[a('img.user-avatar[src="'+e()+'"]')]),a(".w-col.w-col-9.w-col-small-9",[a(".fontweight-semibold.fontsize-smaller.lineheight-tighter.u-marginbottom-10",[a('a.alt-link[target="_blank"][href="/users/'+d.user_id+'/edit"]',d.user_name)]),a(".fontsize-smallest","Usuário: "+d.user_id),a(".fontsize-smallest.fontcolor-secondary","Catarse: "+d.email),a(".fontsize-smallest.fontcolor-secondary","Gateway: "+d.payer_email)])])}}}(window.m),window.c.FilterDateRange=function(a){return{view:function(b,c){return a(".w-col.w-col-3.w-col-small-6",[a('label.fontsize-smaller[for="'+c.index+'"]',c.label),a(".w-row",[a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[id="'+c.index+'"][type="text"]',{onchange:a.withAttr("value",c.first),value:c.first()})]),a(".w-col.w-col-2.w-col-small-2.w-col-tiny-2",[a(".fontsize-smaller.u-text-center.lineheight-looser","e")]),a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[type="text"]',{onchange:a.withAttr("value",c.last),value:c.last()})])])])}}}(window.m),window.c.FilterDropdown=function(a,b){return{view:function(c,d){return a(".w-col.w-col-3.w-col-small-6",[a('label.fontsize-smaller[for="'+d.index+'"]',d.label),a('select.w-select.text-field.positive[id="'+d.index+'"]',{onchange:a.withAttr("value",d.vm),value:d.vm()},[b.map(d.options,function(b){return a('option[value="'+b.value+'"]',b.option)})])])}}}(window.m,window._),window.c.FilterMain=function(a){return{view:function(b,c){return a(".w-row",[a(".w-col.w-col-10",[a('input.w-input.text-field.positive.medium[placeholder="'+c.placeholder+'"][type="text"]',{onchange:a.withAttr("value",c.vm),value:c.vm()})]),a(".w-col.w-col-2",[a('input#filter-btn.btn.btn-large.u-marginbottom-10[type="submit"][value="Buscar"]')])])}}}(window.m),window.c.FilterNumberRange=function(a){return{view:function(b,c){return a(".w-col.w-col-3.w-col-small-6",[a('label.fontsize-smaller[for="'+c.index+'"]',c.label),a(".w-row",[a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[id="'+c.index+'"][type="text"]',{onchange:a.withAttr("value",c.first),value:c.first()})]),a(".w-col.w-col-2.w-col-small-2.w-col-tiny-2",[a(".fontsize-smaller.u-text-center.lineheight-looser","e")]),a(".w-col.w-col-5.w-col-small-5.w-col-tiny-5",[a('input.w-input.text-field.positive[type="text"]',{onchange:a.withAttr("value",c.last),value:c.last()})])])])}}}(window.m),window.c.PaymentStatus=function(a){return{controller:function(b){var c,d,e,f=b.item,g=null;return g=function(){if(f.gateway_data)switch(f.gateway.toLowerCase()){case"moip":return{first_digits:f.gateway_data.cartao_bin,last_digits:f.gateway_data.cartao_final,brand:f.gateway_data.cartao_bandeira};case"pagarme":return{first_digits:f.gateway_data.card_first_digits,last_digits:f.gateway_data.card_last_digits,brand:f.gateway_data.card_brand}}},c=function(){switch(f.payment_method.toLowerCase()){case"boletobancario":return a("span#boleto-detail","");case"cartaodecredito":var b=g();return b?a("#creditcard-detail.fontsize-smallest.fontcolor-secondary.lineheight-tight",[b.first_digits+"******"+b.last_digits,a("br"),b.brand+" "+f.installments+"x"]):""}},d=function(){switch(f.payment_method.toLowerCase()){case"boletobancario":return".fa-barcode";case"cartaodecredito":return".fa-credit-card";default:return".fa-question"}},e=function(){switch(f.state){case"paid":return".text-success";case"refunded":return".text-refunded";case"pending":case"pending_refund":return".text-waiting";default:return".text-error"}},{displayPaymentMethod:c,paymentMethodClass:d,stateClass:e}},view:function(b,c){var d=c.item;return a(".w-row.payment-status",[a(".fontsize-smallest.lineheight-looser.fontweight-semibold",[a("span.fa.fa-circle"+b.stateClass())," "+d.state]),a(".fontsize-smallest.fontweight-semibold",[a("span.fa"+b.paymentMethodClass())," ",a('a.link-hidden[href="#"]',d.payment_method)]),a(".fontsize-smallest.fontcolor-secondary.lineheight-tight",[b.displayPaymentMethod()])])}}}(window.m),window.c.TeamMembers=function(a,b,c){return{controller:function(){var d={collection:b.prop([])},e=function(b,c){return a.map(a.range(Math.ceil(b.length/c)),function(a){return b.slice(a*c,(a+1)*c)})};return c.teamMember.getPage().then(function(a){d.collection(e(a,4))}),{vm:d}},view:function(c){return b("#team-members-static.w-section.section",[b(".w-container",[a.map(c.vm.collection(),function(c){return b(".w-row.u-text-center",[a.map(c,function(a){return b(".team-member.w-col.w-col-3.w-col-small-3.w-col-tiny-6.u-marginbottom-40",[b('a.alt-link[href="/users/'+a.id+'"]',[b('img.thumb.big.u-round.u-marginbottom-10[src="'+a.img+'"]'),b(".fontweight-semibold.fontsize-base",a.name)]),b(".fontsize-smallest.fontcolor-secondary","Apoiou "+a.total_contributed_projects+" projetos")])})])})])])}}}(window._,window.m,window.c.models),window.c.TeamTotal=function(a,b,c){return{controller:function(){var b={collection:a.prop([])};return c.teamTotal.getRow().then(function(a){b.collection(a)}),{vm:b}},view:function(c){return a("#team-total-static.w-section.section-one-column.u-margintop-40.u-text-center.u-marginbottom-20",[c.vm.collection().map(function(c){return a(".w-container",[a(".w-row",[a(".w-col.w-col-2"),a(".w-col.w-col-8",[a(".fontsize-base.u-marginbottom-30","Hoje somos "+c.member_count+" pessoas espalhadas por "+c.total_cities+" cidades em "+c.countries.length+" países ("+c.countries.toString()+")! O Catarse é independente, sem investidores, de código aberto e construído com amor. Nossa paixão é construir um ambiente onde cada vez mais projetos possam ganhar vida."),a(".fontsize-larger.lineheight-tight.text-success","Nossa equipe, junta, já apoiou R$"+b.formatNumber(c.total_amount)+" para "+c.total_contributed_projects+" projetos!")]),a(".w-col.w-col-2")])])})])}}}(window.m,window.c.h,window.c.models),window.c.pages.Team=function(a,b){return{view:function(){return a("#static-team-app",[a.component(b.TeamTotal),a.component(b.TeamMembers)])}}}(window.m,window.c);